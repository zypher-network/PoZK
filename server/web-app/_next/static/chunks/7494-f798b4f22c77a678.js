"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7494],{56200:function(e,t,s){s.d(t,{Z:function(){return A}});var a=s(57437),n=s(47304),r=s(2265),i=s(33514),l=s(54175),o=s(86498),c=s(75897),d=s(4867),u=s(31590),p=s(48185),h=s(54662),m=s(90618),y=s(12757),x=s(78068),g=s(41942),w=s(59313),f=(0,r.memo)(e=>{let{address:t,action:s,open:n,onOpenChange:i}=e,{toast:l}=(0,x.pm)(),[o,d]=(0,r.useState)(!1),{setController:u,deleteController:f,exportController:b}=(0,y.k)(),j=(0,w.Z)(e=>e.fetch),[C,v]=(0,r.useState)(""),{title:N,content:S}=(0,r.useMemo)(()=>"set"===s?{title:"Set Controller?",content:"Are you sure you want to set this controller?"}:"delete"===s?{title:"Delete Controller?",content:"Are you sure you want to delete this controller?"}:"export"===s?{title:"Export Secret Key?",content:"Are you sure you want to export the secret key? This action cannot be undone."}:{title:"",content:""},[s]),k=(0,r.useCallback)(()=>{navigator.clipboard.writeText(C||""),l({variant:"success",title:"Copy Success!"})},[C]),I=(0,r.useCallback)(async()=>{d(!0);let e=!1;if("set"===s&&(e=await u(t)),"delete"===s&&(e=await f()),"export"===s){let[e,s]=await b(t);e&&v(s)}e&&i(!1),console.log("rrrrrrrr fetch"),await j(1),d(!1)},[s]);return(0,a.jsx)(h.Vq,{open:n,onOpenChange:i,children:(0,a.jsxs)(h.cZ,{className:"w-[512px]",children:[(0,a.jsx)(h.fK,{children:(0,a.jsx)(h.$N,{children:N})}),(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[(0,a.jsx)(m.Z,{className:"mt-[32px] mb-[18px]"}),(0,a.jsx)("p",{className:"text-[#ffeb3b] bg-[#303511] rounded-sm py-[4px] px-[20px] text-center mb-[8px]",children:t}),C&&"export"===s?(0,a.jsxs)(p.Zb,{className:"flex justify-center items-center gap-[10px] text-[#26d962] bg-[#093116] rounded-sm py-[10px] px-[20px] mt-[8px]",children:[(0,a.jsx)("p",{className:"flex-8 break-words max-w-[340px]",children:C}),(0,a.jsx)(g.esY,{className:"flex-1",onClick:k})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-[18px] font-light text-center",children:S}),(0,a.jsx)(c.z,{type:"submit",className:"h-[48px] w-[280px] mt-[48px] mb-[20px]  rounded-[100px] text-[20px] ",isLoading:o,onClick:I,children:"Confirm"})]})]})]})})}),b=s(72039);let j="https://gas.zypher.network";class C{async getBalance(e){try{let t=await fetch("".concat(j).concat(this.endpoints.balanceOf).concat(e));return await t.json()}catch(e){console.log(e)}return null}async createAAWallet(e){try{let t=await fetch("".concat(j).concat(this.endpoints.create),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:e})});return await t.json()}catch(e){console.log(e)}return null}constructor(){this.endpoints={balanceOf:"/api/balanceof/",create:"/api/create"}}}var v=new C,N=s(27120),S=s(46799),k=s(87212),I=e=>{let{address:t}=e,[s,n]=(0,r.useState)(!0),[i,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(""),p=(0,r.useMemo)(()=>(0,S._)(),[]),{toast:h}=(0,x.pm)(),{address:m}=(0,k.m)(),y=async()=>{try{var e;let s=await v.getBalance(t),{amount:a,wallet:n}=null!==(e=null==s?void 0:s.data)&&void 0!==e?e:{};if(a&&n){let e=parseInt(a,16);if(l(!!e),e){let e=await p.readContractData("check",[m,n]);u(n),c(e)}}}catch(e){console.log(e)}n(!1)},g=async()=>{try{n(!0);let e=await v.createAAWallet(t);e&&await p.writeContractMethod("add",[e.data.wallet]),y()}catch(e){h({variant:"destructive",title:"Failed",description:(0,a.jsx)("p",{className:"text-[14px]",children:e.message})}),n(!1)}};return(0,r.useEffect)(()=>{y()},[t]),(0,a.jsx)("div",{className:"flex justify-start w-[70px]",children:s?(0,a.jsx)("div",{className:"flex items-center justify-center animate-spin opacity-60",children:(0,a.jsx)(N.Z,{className:"scale-y-[-1]",height:"16px",width:"16px"})}):o?(0,a.jsx)("p",{className:"text-[#26d962]",children:"on"}):i?(0,a.jsx)("div",{className:"py-1 cursor-pointer px-3 rounded text-sm bg-[#674dff]",onClick:g,children:"Set"}):(0,a.jsx)("p",{className:"text-[#9e9e9e]",children:"off"})})},A=(0,r.memo)(()=>{var e;let{toast:t}=(0,x.pm)(),[s,h]=(0,r.useState)(),[m,y]=(0,r.useState)(),g=(0,w.Z)((0,b.N)(e=>({fetching:e.fetching,list:e.controllers,active:e.active}))),[j,C]=(0,r.useState)({}),v=(0,r.useCallback)((e,t)=>{y(e),h(t.address)},[]),N=(0,r.useCallback)(e=>{navigator.clipboard.writeText(e||""),t({variant:"success",title:"Copy Success!"})},[]),S=(0,r.useMemo)(()=>[{accessorKey:"status",header:"Status",cell:e=>{let{row:t}=e;return"on"===t.getValue("status")?(0,a.jsx)("p",{className:"text-[#26d962]",children:t.getValue("status")}):(0,a.jsx)("p",{className:"text-[#9e9e9e]",children:t.getValue("status")})}},{accessorKey:"address",header:e=>{let{column:t}=e;return(0,a.jsxs)(c.z,{variant:"ghost",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Address",(0,a.jsx)(d.jnn,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,a.jsx)("div",{className:"lowercase text-sm",children:t.getValue("address")})}},{id:"zero-gas",header:"0 gas",cell:e=>{let{row:t}=e;return(0,a.jsx)(I,{address:t.getValue("address")})}},{id:"actions",header:"Actions",enableHiding:!1,cell:e=>{let{row:t}=e,s=t.original;return(0,a.jsxs)(u.h_,{children:[(0,a.jsx)(u.$F,{asChild:!0,children:(0,a.jsxs)(c.z,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,a.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,a.jsx)(d.nWS,{className:"h-4 w-4"})]})}),(0,a.jsxs)(u.AW,{align:"end",children:[(0,a.jsx)(u.Ju,{children:"Actions"}),(0,a.jsx)(u.Xi,{onClick:()=>N(s.address),children:"Copy Address"}),(0,a.jsx)(u.VD,{}),"off"===s.status?(0,a.jsx)(u.Xi,{onClick:()=>v("set",s),children:"Set Controller"}):null,(0,a.jsx)(u.Xi,{onClick:()=>v("export",s),children:"Export Secret Key"})]})]})}}],[g.list,g.active]),k=(0,i.b7)({data:g.list,columns:S,getCoreRowModel:(0,l.sC)(),getPaginationRowModel:(0,l.G_)(),getSortedRowModel:(0,l.tj)(),getFilteredRowModel:(0,l.vL)(),onRowSelectionChange:C,state:{rowSelection:j}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(p.Zb,{className:"mt-[40px] max-w-[700px]",children:[(0,a.jsx)("h3",{children:"Controller List"}),(0,a.jsxs)(n.iA,{children:[(0,a.jsx)(n.xD,{children:k.getHeaderGroups().map(e=>(0,a.jsx)(n.SC,{children:e.headers.map((t,s)=>(0,a.jsx)(n.ss,{className:s===e.headers.length-1?"text-right":"text-left",children:t.isPlaceholder?null:(0,i.ie)(t.column.columnDef.header,t.getContext())},t.id))},e.id))}),(0,a.jsxs)(n.RM,{children:[(0,a.jsx)(n.SC,{children:(0,a.jsx)(n.pj,{colSpan:4,className:"h-[16px] bg-transparent"})}),(null===(e=k.getRowModel().rows)||void 0===e?void 0:e.length)?k.getRowModel().rows.map((e,t)=>(0,a.jsx)(n.SC,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map((t,s)=>(0,a.jsx)(n.pj,{className:"bg-slate-800 p-0 h-[44px] ".concat(e.getVisibleCells().length-1===s?"justify-end":""),children:(0,i.ie)(t.column.columnDef.cell,t.getContext())},t.id))},e.id)):(0,a.jsx)(n.SC,{children:(0,a.jsx)(n.pj,{colSpan:S.length,className:"bg-slate-800 h-24 justify-center",children:g.fetching?"Loading":"No results."})})]})]})]}),(0,a.jsx)(f,{action:null!=m?m:"add",onOpenChange:e=>{e||(y(void 0),h(void 0))},open:!!m,address:null!=s?s:o.DR})]})})},12757:function(e,t,s){s.d(t,{k:function(){return y}});var a=s(99441),n=s(2265),r=s(85090),i=s(989),l=s(46799),o=s(78068),c=s(38517),d=s(51356),u=s(45129),p=s(59313),h=s(87212);let m=()=>{let e=(0,d.p)(),[t,s]=(0,a.FV)(i.wQ);return{getData:(0,n.useCallback)(async()=>{try{if(!t.list.length){let e=await r.Z.get("/api/controllers?page_size=100&page_count=1");if(e&&e.data.length){console.log(e);let t=e.main,a=e.data.map(e=>({address:e,status:t===e.toLowerCase()?"on":"off"}));s({isLoading:!1,hasOnController:!!t,list:a.sort((e,t)=>"on"===e.status&&"on"!==t.status?-1:"on"!==e.status&&"on"===t.status?1:0)})}else throw Error("No data")}}catch(t){e(t),s({isLoading:!1,hasOnController:!1,list:[]})}},[t.list.length,s])}},y=()=>{let{getData:e}=m(),{toast:t}=(0,o.pm)(),s=(0,p.Z)(e=>e.fetch),a=(0,d.p)(),{address:i}=(0,h.m)(),y=(0,n.useMemo)(()=>(0,l._)(),[]),x=(0,n.useCallback)(async e=>{await y.writeContractMethod("add",[e])},[y,e]),g=(0,n.useCallback)(async e=>await y.readContractData("check",[i,e]),[y,i]),w=(0,n.useCallback)(async()=>{try{let a=await u.Z.newController();if(a)await x(a),t({title:"Create New Secret Key Success",variant:"success"}),s(1),e();else throw Error("Controller new Error")}catch(e){await a(e)}},[x,t,a]),f=(0,n.useCallback)(async n=>{try{let a=await r.Z.post("/api/controllers",{signing_key:n});if(a.controller){let a=c.a.getAccount(n);await g(a)?await r.Z.post("/api/controllers/".concat(a),void 0):await x(a),t({title:"Add New Secret Key Success",variant:"success"}),s(1),e()}else throw Error(null!=a?a:"Controller add Error")}catch(e){await a(e)}},[x,t,a]);return{newController:w,addController:f,setController:(0,n.useCallback)(async s=>{try{let a=await r.Z.post("/api/controllers/".concat(s),void 0);if("success"===a.status)return t({title:"Set controller Success",variant:"success"}),e(),!0;throw Error(null!=a?a:"Controller set Error")}catch(e){return await a(e),!1}},[]),deleteController:(0,n.useCallback)(()=>!1,[]),exportController:(0,n.useCallback)(async e=>{try{let t=await r.Z.get("/api/controllers/".concat(e),void 0);if(console.log({res:t}),t.singing_key)return[!0,t.singing_key];throw Error(null!=t?t:"Controller set Error")}catch(e){return await a(e),[!1,""]}},[])}}},16662:function(e,t,s){var a=s(57437),n=s(16463),r=s(2265),i=s(41942);t.default=(0,r.memo)(()=>{let e=(0,n.useRouter)(),t=(0,r.useCallback)(()=>{e.back()},[]);return(0,a.jsx)(i._HU,{className:"cursor-pointer",onClick:t})})},46799:function(e,t,s){s.d(t,{_:function(){return i}});var a=s(43665),n=JSON.parse('[{"inputs":[],"name":"InvalidInitialization","type":"error"},{"inputs":[],"name":"NotInitializing","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"},{"indexed":false,"internalType":"address","name":"controller","type":"address"},{"indexed":false,"internalType":"bool","name":"isAdd","type":"bool"}],"name":"ChangeController","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"version","type":"uint64"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[{"internalType":"address","name":"controller","type":"address"}],"name":"add","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"controller","type":"address"}],"name":"check","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_addresses","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"controller","type":"address"}],"name":"remove","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_addresses","type":"address"}],"name":"setAddresses","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),r=s(43710);let i=()=>{let e=a.iF[a.lG].Controller;return new r.Z(e,n)}},38517:function(e,t,s){s.d(t,{a:function(){return o}});var a=s(99112),n=s(21019),r=s(66594),i=s(43665);class l{init(){if("ethereum"in window){let e=window.ethereum;this.provider=e}else window.open("https://metamask.io/","_blank")}getPublicKey(e){return(0,r.L)(e).publicKey}getAccount(e){return(0,r.L)(e).address}getAddress(e){return(0,a.K)(e)}async connect(){if(!this.provider)return!1;let e=await this.provider.request({method:"eth_requestAccounts"}),t=await this.provider.request({method:"eth_chainId",params:[]});return this.chainId=(0,n.ly)(t),this.address=(0,a.K)(e[0]),!0}async getNonce(){return parseInt(await this.provider.request({method:"eth_getTransactionCount",params:[this.address,"latest"]}),16).toString()}async getBlockNumber(){return parseInt(await this.provider.request({method:"eth_blockNumber",params:[]}),16).toString()}async initAndConnect(){this.init(),await this.connect()}async signByEIP4361(e){await this.initAndConnect();let t=await this.getBlockNumber(),s=this.chainId;if(console.log({a:s!==Number(i.lG),chainId:s,CHAINID:Number(i.lG)}),s!==Number(i.lG))throw Error("Please try late~");let a={domain:location.host,chainId:this.chainId,origin:location.origin,issuedAt:new Date().toISOString(),version:"1",nonce:t,statement:e,signType:"EIP-4361",address:o.address};return this.sign(JSON.stringify(a))}async sign(e){let t=JSON.parse(e);console.log({msgData:t});let s="EIP-4361"===t.signType?this.to4361Message({domain:t.domain,chainId:t.chainId||"",uri:t.origin,issuedAt:t.issuedAt,version:t.version,nonce:t.nonce,statement:t.statement,address:t.address}):e,a=await this.provider.request({method:"personal_sign",params:[s,this.address]});return{message:s,signature:a,...t}}to4361Message(e){let{domain:t,version:s,nonce:a,issuedAt:n,statement:r,chainId:i,uri:l,address:o}=e,c=["".concat(t," wants you to sign in with your Ethereum account:"),o].join("\n"),d=a.length,u=a;d<8&&(u="0".repeat(8-d)+a);let p="Nonce: ".concat(u),h=["URI: ".concat(l),"Version: ".concat(s),"Chain ID: "+i,p];h.push("Issued At: ".concat(n));let m=h.join("\n");return c=[c,r].join("\n\n"),r&&(c+="\n"),[c,m].join("\n")}async signByEIP712(e){await this.initAndConnect();let t=await this.provider.request({method:"eth_signTypedData_v4",params:[this.address,e]});return{message:e,signature:t}}async getIdentityByWallet(e){let t=(await o.signByEIP712(JSON.stringify({types:{EIP712Domain:[{name:"name",type:"string"}],Info:[{name:"seed",type:"string"}]},primaryType:"Info",domain:{name:"Secure Note"},message:{seed:e}}))).signature.slice(0,66),s=o.getPublicKey(t);return{privateKey:t,publicKey:s}}constructor(){this.chainId=0,this.address=""}}let o=new l}}]);